<script>
  const PRODUCTS = [
    {id:1,name:'Red Lightning Flag',price:2.50,desc:'Fast delivery, as soon as you pay'},
    {id:2,name:'Blue Speed Flag',price:3.00,desc:'Ping Flags,Delay Flags and Free Flags, Daily Drops'},
    {id:3,name:'Golden VIP Flag',price:5.00,desc:'Limited edition'},
    {id:4,name:'Shadow Flag',price:2.00,desc:'Low price, quick delivery'}
  ];

  const productsEl = document.getElementById('products')
  const countEl = document.getElementById('count')
  const cartModal = document.getElementById('cartModal')
  const cartItemsEl = document.getElementById('cartItems')
  const totalEl = document.getElementById('total')

  function renderProducts(){
    productsEl.innerHTML = ''
    PRODUCTS.forEach(p=>{
      const div = document.createElement('div')
      div.className='card'
      div.innerHTML = `
        <div class="flag">${p.name.split(' ')[0]}</div>
        <div class="name">${p.name}</div>
        <div class="small">${p.desc}</div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
          <div class="price">$${p.price.toFixed(2)}</div>
          <button onclick="addToCart(${p.id})">Add</button>
        </div>`
      productsEl.appendChild(div)
    })
  }

  function getCart(){ return JSON.parse(localStorage.getItem('rays_cart')||'{}') }
  function saveCart(c){ localStorage.setItem('rays_cart',JSON.stringify(c)); updateCount() }
  function addToCart(id){ 
    const c=getCart(); 
    c[id]=(c[id]||0)+1; 
    saveCart(c); 
    alert('Added to cart'); 
  }
  function updateCount(){ 
    const c=getCart(); 
    const count=Object.values(c).reduce((a,b)=>a+b,0); 
    countEl.textContent=count 
  }

  function openCart(){ renderCart(); cartModal.style.display='block' }
  function closeCart(){ cartModal.style.display='none' }

  function renderCart(){
    const c=getCart(); 
    cartItemsEl.innerHTML=''
    let sum=0
    Object.keys(c).forEach(id=>{
      const p = PRODUCTS.find(x=>x.id==id)
      const qty = c[id]
      const line = document.createElement('div')
      line.className='cart-item'
      line.innerHTML = `<div>${p.name} <div class="small">x${qty}</div></div><div>$${(p.price*qty).toFixed(2)}</div>`
      cartItemsEl.appendChild(line)
      sum += p.price*qty
    })
    totalEl.textContent = '$'+sum.toFixed(2)
  }

  function checkout(){
    const c=getCart(); 
    if(Object.keys(c).length==0){
      alert('Cart is empty')
      return
    }
    const summary = Object.keys(c).map(id=>{
      const p=PRODUCTS.find(x=>x.id==id)
      return `${p.name} x${c[id]}`
    }).join('\n')
    
    // Copy summary to clipboard
    navigator.clipboard.writeText(`Order:\n${summary}\nTotal: ${totalEl.textContent}\nDiscord: @rattyray1\nServer: https://discord.gg/W8w94pUtgt`)

    // Open Discord DM link (will fallback to Discord app)
    const discordUrl = 'https://discord.com/users/@rattyray1'
    const serverInvite = 'https://discord.gg/W8w94pUtgt'
    window.open(serverInvite,'_blank') // Open server
    alert(`Order summary copied! Message @rattyray1 on Discord to complete purchase.\nServer invite opened.`)
    
    // Clear cart
    localStorage.removeItem('rays_cart')
    updateCount()
    closeCart()
  }

  document.getElementById('openCart').addEventListener('click', openCart)
  document.getElementById('closeCart').addEventListener('click', closeCart)
  document.getElementById('checkoutBtn').addEventListener('click', checkout)

  // Initial render
  renderProducts(); 
  updateCount();
</script>
